import random import time from influxdb_client import InfluxDBClient, Point # ---------------- CONFIGURATION ---------------- INFLUX_URL = "http://172.20.10.3:8086" INFLUX_TOKEN = "ezq1o5_qLRvPAVHbsAi6H6OS3O-Y5hSgc7fhEChRmQ5_MhsUbZbLfabK0hE2jPJcsxGol43mvC3YHS373sE-dw==" INFLUX_ORG = "raspberrypi" INFLUX_BUCKET = "epcdata" # ------------------------------------------------ # Store the latest values from all sensors (same structure as your real script) latest_data = { "temperature": None, "pressure": None, "humidity": None, "voltage": None, "current": None, "power": None, "vibration": False, "gasStatus": False, "magneticField": 0, "doorStatus": False } # Connect to InfluxDB client = InfluxDBClient(url=INFLUX_URL, token=INFLUX_TOKEN, org=INFLUX_ORG) write_api = client.write_api() def generate_fake_data(): """Generate fake values for development purposes.""" latest_data["temperature"] = round(random.uniform(20.0, 30.0), 1) latest_data["pressure"] = round(random.uniform(990.0, 1020.0), 1) latest_data["humidity"] = round(random.uniform(30.0, 70.0), 1) latest_data["voltage"] = round(random.uniform(215.0, 225.0), 1) latest_data["current"] = round(random.uniform(4.0, 6.0), 2) latest_data["power"] = round(random.uniform(900.0, 1350.0), 1) # just fake latest_data["vibration"] = random.choice([True, False]) latest_data["gasStatus"] = random.choice([True, False]) latest_data["magneticField"] = random.randint(0, 100) latest_data["doorStatus"] = random.choice([True, False]) def write_to_influx(): """Write the current snapshot to InfluxDB (matches your real function).""" point = Point("sensor_data") # Floats for key in ["temperature", "pressure", "humidity", "voltage", "current", "power"]: val = latest_data[key] if val is not None: try: point.field(key, float(val)) except (ValueError, TypeError): print(f"Skipping invalid float for {key}: {val}") # Integer try: point.field("magneticField", int(latest_data["magneticField"])) except (ValueError, TypeError): print(f"Invalid integer for magneticField: {latest_data['magneticField']}") # Booleans for key in ["vibration", "gasStatus", "doorStatus"]: point.field(key, bool(latest_data[key])) write_api.write(bucket=INFLUX_BUCKET, org=INFLUX_ORG, record=point) print(f"Wrote snapshot: {latest_data}") # --- Main loop for development --- print("Starting fake data generation for development...") while True: generate_fake_data() write_to_influx() time.sleep(5) # update every 5 seconds
